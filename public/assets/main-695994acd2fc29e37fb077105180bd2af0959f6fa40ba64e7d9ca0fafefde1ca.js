function worker(){$.ajax({url:"/getVoices/",success:function(e){for(i=0;i<e.length;i++)e[i].id>highestID&&(AddsceneCSSElementsIndividual(e[i].id,e[i].text),highestID=e[i].id)},complete:function(){setTimeout(worker,5e3)}})}function Init(){sceneGL=new THREE.Scene,sceneCSS=new THREE.Scene,camera=new THREE.PerspectiveCamera(70,window.innerWidth/window.innerHeight,.1,5e4),camera.position.set(0*g_mapScaleFactor,2.8*g_mapScaleFactor,9*g_mapScaleFactor),rendererGL=new THREE.WebGLRenderer,rendererGL.domElement.style.top=0,rendererGL.setSize(window.innerWidth,window.innerHeight),rendererCSS=new THREE.CSS3DRenderer,rendererCSS.setSize(window.innerWidth,window.innerHeight),rendererCSS.domElement.style.position="absolute",rendererCSS.domElement.style.top=0,document.body.appendChild(rendererGL.domElement),document.body.appendChild(rendererCSS.domElement),AddLights(),AddsceneGLElements(),raycaster=new THREE.Raycaster,mouse=new THREE.Vector2,window.addEventListener("mousemove",onMouseMove,!1),window.addEventListener("mousedown",onMouseDown,!1),window.addEventListener("resize",onWindowResize,!1),USE_MOUSE&&(controls=new THREE.OrbitControls(camera),controls.target=new THREE.Vector3(0*g_mapScaleFactor,2.8*g_mapScaleFactor,0*g_mapScaleFactor),controls.zoomSpeed=.3),USE_VR&&(controls=new THREE.VRControls(camera),effect=new THREE.VREffect(rendererGL),effect.setSize(window.innerWidth,window.innerHeight))}function onMouseMove(e){mouse.x=2*(e.clientX/window.innerWidth)-1,mouse.y=1-2*(e.clientY/window.innerHeight)}function onMouseDown(){m_intersectMapObjectNum>0&&g_mapObjects.children.forEach(function(e){if(e.id+1==m_intersectMapObjectID){m_intersectMapObjectName=e.Name;var t=document.getElementById("populationDisplay");t.innerHTML=populationArray[m_intersectMapObjectName].district+"<br>"+populationArray[m_intersectMapObjectName].population+" people"}})}function buildAxes(e){var t=new THREE.Object3D;return t.add(buildAxis(new THREE.Vector3(0,0,0),new THREE.Vector3(e,0,0),16711680,!1)),t.add(buildAxis(new THREE.Vector3(0,0,0),new THREE.Vector3(-e,0,0),16711680,!0)),t.add(buildAxis(new THREE.Vector3(0,0,0),new THREE.Vector3(0,e,0),65280,!1)),t.add(buildAxis(new THREE.Vector3(0,0,0),new THREE.Vector3(0,-e,0),65280,!0)),t.add(buildAxis(new THREE.Vector3(0,0,0),new THREE.Vector3(0,0,e),255,!1)),t.add(buildAxis(new THREE.Vector3(0,0,0),new THREE.Vector3(0,0,-e),255,!0)),t}function buildAxis(e,t,o,a){var n,i=new THREE.Geometry;n=a?new THREE.LineDashedMaterial({linewidth:3,color:o,dashSize:3,gapSize:3}):new THREE.LineBasicMaterial({linewidth:3,color:o}),i.vertices.push(e.clone()),i.vertices.push(t.clone()),i.computeLineDistances();var s=new THREE.Line(i,n,THREE.LinePieces);return s}function AddLights(){var e=new THREE.AmbientLight(4210752);sceneGL.add(e),dirLight=new THREE.DirectionalLight(16777215,1),dirLight.position.set(0,0,10),sceneGL.add(dirLight)}function Animate(){RotateCommentObjects(),CheckCommentObjectTransparency(),AdjustMapPosRot(),SelectMapObject(),render(),requestAnimationFrame(Animate),controls.update()}function CheckCommentObjectTransparency(){t_camRotation=camera.rotation;var e=t_camRotation.x,t=t_camRotation.y,o=(t_camRotation.z,new THREE.Vector3);o.x=Math.sin(t),o.y=-Math.cos(t)*Math.sin(e),o.z=Math.cos(e)*Math.cos(t),t_camPosition=camera.position;for(var a=t_camPosition.dot(o),n=0;n<m_cssObjects.length;n++){var i=m_cssObjects[n],s=!0;g_mapSG.children.forEach(function(e){e.traverse(function(e){if(e instanceof THREE.Mesh){var t=new THREE.Vector3;t.subVectors(i.position,t_camPosition);var n=-1*t.dot(o);if(n-a>0){var r=a/n,c=t;c.multiplyScalar(r);var d=new THREE.Vector3;d.addVectors(t_camPosition,c);var m=(new THREE.Box3).setFromObject(e);m.expandByScalar(2);var l=m.containsPoint(d);1==l&&(s=!1)}}})}),0==s?(i.element.style.backgroundColor="rgba(255,255,255,0)",i.element.children[0].style.color="rgba(255,255,255,0)",i.element.children[1].style.color="rgba(255,255,255,0)",i.element.style.border="none"):(i.element.style.backgroundColor="rgba(255,255,255,"+CSS_ALPHA+")",i.element.children[0].style.color="rgba(255,255,255,"+CSS_ALPHA+")",i.element.children[1].style.color="rgba(255,255,255,"+CSS_ALPHA+")",i.element.style.border="5px solid rgba(255,255,255,1)")}}function RotateCommentObjects(){g_time+=.001;for(var e,t=[30,30,30,30,30],o=[30,30,30,30,30],a=0,n=0;n<m_cssObjects.length;n++){var i=t[a];o[a]=o[a]-1,o[a]<0&&(a+=1),e=n*(2*Math.PI/i);var s=m_cssObjects[n],r=0;r=Math.abs(a)%2==1?1:-1,2>=a?(s.position.x=(3e3-300*a)*Math.sin(2*Math.PI*g_time*r+e),s.position.y=1e3+400*a,s.position.z=(3e3-300*a)*Math.cos(2*Math.PI*g_time*r+e)):(s.position.x=(3e3-300*(a-2))*Math.sin(2*Math.PI*g_time*r+e),s.position.y=1e3-400*(a-2),s.position.z=(3e3-300*(a-2))*Math.cos(2*Math.PI*g_time*r+e))}}function AdjustMapPosRot(){t_camRotation=camera.rotation,g_mapObjects.children.forEach(function(e){e.traverse(function(e){e instanceof THREE.Mesh&&e.rotation.set(t_camRotation.x,t_camRotation.y,t_camRotation.z)})}),g_mapSG.children.forEach(function(e){e.traverse(function(e){e instanceof THREE.Mesh&&e.rotation.set(t_camRotation.x,t_camRotation.y,t_camRotation.z)})});var e=t_camRotation.x,t=t_camRotation.y,o=(t_camRotation.z,Math.sin(t)),a=-Math.cos(t)*Math.sin(e),n=Math.cos(e)*Math.cos(t);dirLight.position.set(10*o*g_mapScaleFactor,10*a*g_mapScaleFactor,10*n*g_mapScaleFactor)}function SelectMapObject(){raycaster.setFromCamera(mouse,camera);var e=raycaster.intersectObjects(g_mapObjects.children,!0);if(m_intersectMapObjectNum=e.length,e.length>0){var t=e[0],o=t.object;m_intersectMapObjectID=o.id}g_mapObjects.children.forEach(function(e){var t=new THREE.MeshLambertMaterial;t.color.setRGB(1,0,0),e.traverse(function(e){e instanceof THREE.Mesh&&(e.material.color.setRGB(1,0,0),e.castShadow=!0,e.receiveShadow=!0)})});for(var a=0;a<e.length;a++){var t=e[a],o=t.object;o.traverse(function(e){e instanceof THREE.Mesh&&(e.material.color.setRGB(0,1,0),e.castShadow=!0,e.receiveShadow=!0)})}}function render(){USE_MOUSE&&(rendererGL.render(sceneGL,camera),rendererCSS.render(sceneCSS,camera)),USE_VR&&(effect.render(sceneGL,camera),rendererCSS.render(sceneCSS,camera))}function onWindowResize(){camera.aspect=window.innerWidth/window.innerHeight,camera.updateProjectionMatrix(),rendererGL.setSize(window.innerWidth,window.innerHeight),render()}function AddLights(){var e=new THREE.AmbientLight(4210752);sceneGL.add(e),dirLight=new THREE.DirectionalLight(16777215,1),dirLight.position.set(0,0,10),sceneGL.add(dirLight)}function AddsceneCSSElementsIndividual(e,t){var o=document.createElement("div");o.className="element",o.style.backgroundColor="rgba(255,255,255,"+CSS_ALPHA+")",o.style.width="200px",o.style.height="200px";var a=document.createElement("div");a.className="symbol",a.textContent=e,o.appendChild(a);var n=document.createElement("div");n.className="details",n.innerHTML=t,o.appendChild(n);var i=new THREE.CSS3DObject(o);i.position.x=0,i.position.y=0,i.position.z=0,sceneCSS.add(i),m_cssObjects.push(i),o.parent=i,i.element.onclick=function(){GetCSSElementInfo(this)}}function AddsceneCSSElements(){for(var e=0;e<table.length;e++){var t=table[e],o=document.createElement("div");o.className="element",o.style.backgroundColor="rgba(255,255,255,"+CSS_ALPHA+")",o.style.width="200px",o.style.height="200px";var a=document.createElement("div");a.className="symbol",a.textContent=t[0],o.appendChild(a);var n=document.createElement("div");n.className="details",n.innerHTML=t[1]+"<br>"+t[2],o.appendChild(n);var i=new THREE.CSS3DObject(o);i.position.x=0,i.position.y=0,i.position.z=-100,sceneCSS.add(i),m_cssObjects.push(i),o.parent=i,i.element.onclick=function(){GetCSSElementInfo(this)}}}function GetCSSElementInfo(e){console.log(e.children[2].innerHTML),e.style.border="30px solid rgba(255,255,255,1.0)"}function AddsceneGLElements(){g_mapSG=new THREE.Object3D,sceneGL.add(g_mapSG),g_mapObjects=new THREE.Object3D,sceneGL.add(g_mapObjects),LoadOBJFiles("obj/SG_AngMoKio.obj",g_mapObjects,0),LoadOBJFiles("obj/SG_Bedok.obj",g_mapObjects,1),LoadOBJFiles("obj/SG_Bishan.obj",g_mapObjects,2),LoadOBJFiles("obj/SG_BoonLay.obj",g_mapObjects,3),LoadOBJFiles("obj/SG_BukitBatok.obj",g_mapObjects,4),LoadOBJFiles("obj/SG_BukitMerah.obj",g_mapObjects,5),LoadOBJFiles("obj/SG_BukitPanjang.obj",g_mapObjects,6),LoadOBJFiles("obj/SG_BukitTimah.obj",g_mapObjects,7),LoadOBJFiles("obj/SG_CCK.obj",g_mapObjects,8),LoadOBJFiles("obj/SG_CentralCatchmentArea.obj",g_mapObjects,9),LoadOBJFiles("obj/SG_CentralRegion.obj",g_mapObjects,10),LoadOBJFiles("obj/SG_Changi.obj",g_mapObjects,11),LoadOBJFiles("obj/SG_Clementi.obj",g_mapObjects,12),LoadOBJFiles("obj/SG_Geylang.obj",g_mapObjects,13),LoadOBJFiles("obj/SG_Hougang.obj",g_mapObjects,14),LoadOBJFiles("obj/SG_JurongEast.obj",g_mapObjects,15),LoadOBJFiles("obj/SG_JurongIsland.obj",g_mapObjects,16),LoadOBJFiles("obj/SG_JurongWest.obj",g_mapObjects,17),LoadOBJFiles("obj/SG_Kallang.obj",g_mapObjects,18),LoadOBJFiles("obj/SG_LimChuKang.obj",g_mapObjects,19),LoadOBJFiles("obj/SG_Mandai.obj",g_mapObjects,20),LoadOBJFiles("obj/SG_MarineParade.obj",g_mapObjects,21),LoadOBJFiles("obj/SG_Novena.obj",g_mapObjects,22),LoadOBJFiles("obj/SG_PasirRis.obj",g_mapObjects,23),LoadOBJFiles("obj/SG_PeyaLebar.obj",g_mapObjects,24),LoadOBJFiles("obj/SG_Pioneer.obj",g_mapObjects,25),LoadOBJFiles("obj/SG_Punggol.obj",g_mapObjects,26),LoadOBJFiles("obj/SG_QueensTown.obj",g_mapObjects,27),LoadOBJFiles("obj/SG_Seletar.obj",g_mapObjects,28),LoadOBJFiles("obj/SG_Sembawang.obj",g_mapObjects,29),LoadOBJFiles("obj/SG_Sengkang.obj",g_mapObjects,30),LoadOBJFiles("obj/SG_Sentosa.obj",g_mapObjects,31),LoadOBJFiles("obj/SG_Serangoon.obj",g_mapObjects,32),LoadOBJFiles("obj/SG_Simpang.obj",g_mapObjects,33),LoadOBJFiles("obj/SG_SungeiKaduh.obj",g_mapObjects,34),LoadOBJFiles("obj/SG_Tampines.obj",g_mapObjects,35),LoadOBJFiles("obj/SG_Tanglin.obj",g_mapObjects,36),LoadOBJFiles("obj/SG_Tengah.obj",g_mapObjects,37),LoadOBJFiles("obj/SG_ToaPayoh.obj",g_mapObjects,38),LoadOBJFiles("obj/SG_Tuas.obj",g_mapObjects,39),LoadOBJFiles("obj/SG_Ubin.obj",g_mapObjects,40),LoadOBJFiles("obj/SG_WestCatchmentArea.obj",g_mapObjects,41),LoadOBJFiles("obj/SG_Woodlands.obj",g_mapObjects,42),LoadOBJFiles("obj/SG_Yishun.obj",g_mapObjects,43),LoadOBJFilesTransparent("obj/Singapore.obj",g_mapSG,1)}function LoadOBJFiles(e,t,o){var a=new THREE.OBJLoader;a.load(e,function(e){var a=new THREE.MeshPhongMaterial({color:10903040});e.scale.set(g_mapScaleFactor,g_mapScaleFactor,g_mapScaleFactor),e.Name=o,e.traverse(function(e){e instanceof THREE.Mesh&&(e.material=a,e.castShadow=!0,e.receiveShadow=!0)}),t.add(e)})}function LoadOBJFilesTransparent(e,t,o){var a=new THREE.OBJLoader;a.load(e,function(e){var a=new THREE.MeshPhongMaterial({color:10903040,opacity:0,transparent:!0});e.scale.set(g_mapScaleFactor,g_mapScaleFactor,g_mapScaleFactor),e.Name=o,e.traverse(function(e){e instanceof THREE.Mesh&&(e.material=a,e.castShadow=!0,e.receiveShadow=!0)}),t.add(e)})}function transform(e,t){TWEEN.removeAll();for(var o=0;o<m_cssObjects.length;o++){var a=m_cssObjects[o],n=e[o];new TWEEN.Tween(a.position).to({x:n.position.x,y:n.position.y,z:n.position.z},Math.random()*t+t).easing(TWEEN.Easing.Exponential.InOut).start(),new TWEEN.Tween(a.rotation).to({x:n.rotation.x,y:n.rotation.y,z:n.rotation.z},Math.random()*t+t).easing(TWEEN.Easing.Exponential.InOut).start()}new TWEEN.Tween(this).to({},2*t).onUpdate(render).start()}var USE_MOUSE=!0,USE_VR=!1,CSS_ALPHA=.6,g_mapScaleFactor=400,table=[["hello","1"],["IT's SG50!!",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""]],jsonwindow=document.getElementById("jsonWindow"),rawjsonwindow=document.getElementById("rawJsonWindow");$(document).ready(function(){setTimeout(worker,1e3)});var highestID=0,camera,sceneGL,rendererGL,m_intersectMapObjectNum=0,m_intersectMapObjectID=0,m_intersectMapObjectName=-1,sceneCSS,rendererCSS,dirLight,plane,g_mapObjects,g_mapSG,mouse,raycaster,g_time=0,m_cssObjects=[],targets={table:[],sphere:[],helix:[],grid:[]},effect;Init(),Animate();